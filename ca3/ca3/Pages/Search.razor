@page "/search"
@inject HttpClient Http

<h1>Search</h1>


<form @onsubmit="Searching">
    <input @bind="@searchValue" type="text" placeholder="Search.." name="search">
    <button type="submit">Search</button>
</form>

@if (searchResults == null)
{
    <p><em>No Results to show</em></p>
}
else
{
    <h3>People</h3>
    @foreach (var p in searchResults.people_results)
    {
        <a href="/personinfo/@p.id"><p>@p.name</p></a>
    }
    <br />
    <h3>Title</h3>
    @foreach (var t in searchResults.title_results)
    {

      <a href="/title/@t.id"><p>@t.name</p></a>
        
    }
}

@code {

    private SearchResult searchResults;
    private string searchValue;
    private string lastValueSearched;


    protected async Task Searching()
    {
        if (searchValue != null && lastValueSearched != searchValue)
        {
            string searchValueHttp = searchValue.Replace(" ", "%20");
            lastValueSearched = searchValue;

            string httpString = $"https://api.watchmode.com/v1/search/?apiKey=vMCQ0i6AkMxAo5afgFFjxSZVpAbpM6oiPNprmEZl&search_field=name&search_value={searchValueHttp}";
            searchResults = await Http.GetFromJsonAsync<SearchResult>(httpString);
        }
    }

    public class TitleResult
    {
        public string resultType { get; set; }
        public int id { get; set; }
        public string name { get; set; }
        public string type { get; set; }
        public int year { get; set; }
        public string imdb_id { get; set; }
        public int tmdb_id { get; set; }
        public string tmdb_type { get; set; }
    }

    public class PeopleResult
    {
        public string resultType { get; set; }
        public int id { get; set; }
        public string name { get; set; }
        public string main_profession { get; set; }
        public string imdb_id { get; set; }
        public int tmdb_id { get; set; }
    }

    public class SearchResult
    {
        public List<TitleResult> title_results { get; set; }
        public List<PeopleResult> people_results { get; set; }
    }





    /*
<select @onchange="setGenre">
    <option value="@int.MaxValue">All</option>
    @foreach (var genre in genres)
    {
        <option value=@genre.id>@genre.name</option>
    }
</select>
genres = await Http.GetFromJsonAsync<Genres[]>("https://api.watchmode.com/v1/genres/?apiKey=vMCQ0i6AkMxAo5afgFFjxSZVpAbpM6oiPNprmEZl");
private Genres[] genres;
private int genre = int.MaxValue;
public void setGenre(ChangeEventArgs e)
{
    genre = Int32.Parse(e.Value.ToString());
}
public class Genres
{
    public int id { get; set; }
    public string name { get; set; }
    public int? tmdb_id { get; set; }
}*/
}
